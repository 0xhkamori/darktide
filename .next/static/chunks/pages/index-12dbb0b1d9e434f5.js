(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{8312:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return r(4528)}])},4528:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return d}});var a=r(5893),s=r(7294),n=r(1163),l=r(4221);function i(e){let{onSubmit:t,isLoading:r,error:n}=e,[i,o]=(0,s.useState)(""),[c,d]=(0,s.useState)(""),[u,m]=(0,s.useState)(""),[p,x]=(0,s.useState)(!1),h=async e=>{e.preventDefault(),await t(i,c,u)};return(0,a.jsx)(l.E.div,{initial:{opacity:0},animate:{opacity:1},className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:(0,a.jsxs)(l.E.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},transition:{delay:.1},className:"bg-background rounded-lg shadow-xl p-6 max-w-md w-full",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold text-primary mb-2",children:"Welcome to Dark Tide"}),(0,a.jsx)("p",{className:"text-text-secondary mb-6",children:"Please follow the steps below to connect your EduVulcan account"}),n&&(0,a.jsx)("div",{className:"bg-red-500/10 border border-red-500 text-red-500 rounded p-3 mb-4",children:n}),(0,a.jsxs)("form",{onSubmit:h,children:[(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-1",children:[(0,a.jsx)("label",{htmlFor:"apiap",className:"block text-sm font-medium text-text-primary",children:"EduVulcan API Key"}),(0,a.jsxs)("div",{className:"flex space-x-2",children:[(0,a.jsx)("button",{type:"button",onClick:()=>{o('<html><head></head><body><input id="ap" type="hidden" value="{&quot;Tokens&quot;:[...],&quot;Alias&quot;:&quot;email@example.com&quot;,...}"></body></html>')},className:"text-xs text-primary hover:text-primary/80",children:"Show Example"}),(0,a.jsxs)("button",{type:"button",onClick:()=>x(!p),className:"text-xs text-primary hover:text-primary/80",children:[p?"Hide":"Show"," Key"]})]})]}),(0,a.jsx)("textarea",{id:"apiap",rows:5,value:i,onChange:e=>o(e.target.value),className:"w-full px-3 py-2 bg-background border border-border rounded-md focus:outline-none focus:ring-2 focus:ring-primary",placeholder:"Paste the entire content from Step 2 here",style:{filter:p?"none":"blur(4px)",transition:"filter 0.2s ease"},required:!0}),(0,a.jsxs)("div",{className:"mt-2 space-y-2 text-xs text-text-secondary",children:[(0,a.jsx)("h3",{className:"font-bold text-sm text-primary mb-1",children:"How to get your API key:"}),(0,a.jsxs)("ol",{className:"list-decimal pl-5 space-y-2",children:[(0,a.jsxs)("li",{children:[(0,a.jsx)("strong",{children:"Step 1:"})," Log into your account at"," ",(0,a.jsx)("a",{href:"https://eduvulcan.pl",target:"_blank",rel:"noopener noreferrer",className:"text-primary hover:underline",children:"EduVulcan portal"})]}),(0,a.jsxs)("li",{children:[(0,a.jsx)("strong",{children:"Step 2:"})," Open this URL:"," ",(0,a.jsx)("a",{href:"view-source:https://eduvulcan.pl/api/ap/",target:"_blank",rel:"noopener noreferrer",className:"text-primary hover:underline break-words",children:"view-source:https://eduvulcan.pl/api/ap/"})]}),(0,a.jsxs)("li",{children:[(0,a.jsx)("strong",{children:"Step 3:"})," Copy the ",(0,a.jsx)("strong",{children:"entire"})," content of the page and paste it into the field above"]})]}),(0,a.jsx)("p",{className:"mt-3",children:"The correct API key format looks like:"}),(0,a.jsx)("p",{className:"bg-gray-800 p-2 rounded overflow-hidden text-xs",style:{wordBreak:"break-all"},children:(0,a.jsx)("code",{children:'<html><head></head><body><input id="ap" type="hidden" value="{"Tokens": [...] ..."></body></html>'})})]})]}),(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("label",{htmlFor:"name",className:"block text-sm font-medium text-text-primary mb-1",children:"Your Full Name"}),(0,a.jsx)("input",{type:"text",id:"name",value:c,onChange:e=>d(e.target.value),className:"w-full px-3 py-2 bg-background border border-border rounded-md focus:outline-none focus:ring-2 focus:ring-primary",placeholder:"Enter your full name",required:!0})]}),(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsx)("label",{htmlFor:"email",className:"block text-sm font-medium text-text-primary mb-1",children:"Your Email Address"}),(0,a.jsx)("input",{type:"email",id:"email",value:u,onChange:e=>m(e.target.value),className:"w-full px-3 py-2 bg-background border border-border rounded-md focus:outline-none focus:ring-2 focus:ring-primary",placeholder:"Enter your email address",required:!0})]}),(0,a.jsx)("button",{type:"submit",disabled:r,className:"w-full bg-primary hover:bg-primary/90 text-white py-2 px-4 rounded-md transition-colors focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 disabled:opacity-70 disabled:cursor-not-allowed",children:r?(0,a.jsxs)("span",{className:"flex items-center justify-center",children:[(0,a.jsxs)("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,a.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,a.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Connecting..."]}):"Connect to EduVulcan"})]})]})})}var o=r(7592),c=r(5654);function d(){let e=(0,n.useRouter)(),[t,r]=(0,s.useState)(!1),[d,u]=(0,s.useState)(!1),[m,p]=(0,s.useState)(null),{setApiap:x}=(0,c.z)();(0,s.useEffect)(()=>{let{apiap:t,name:a,email:s}=(0,o.is)();if(t&&a&&s){let t=setTimeout(()=>{e.push("/dashboard")},1500);return()=>clearTimeout(t)}{let e=setTimeout(()=>{r(!0)},1e3);return()=>clearTimeout(e)}},[e]);let h=async(t,r,a)=>{u(!0),p(null);try{console.log("Authenticating with API key...");let s=await fetch("/api/validate-apiap",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({apiap:t})}),n=await s.json();n.success?(console.log("Authentication successful, saving user data..."),(0,o.gt)(t,r,a),x(t),e.push("/dashboard").then(()=>{window.location.reload()})):(console.error("Authentication failed:",n.error),p(n.error||"Invalid API key. Please check and try again."))}catch(e){console.error("Authentication error:",e),p(e instanceof Error?e.message:"Failed to validate API key. Please try again.")}finally{u(!1)}};return(0,a.jsxs)("div",{className:"min-h-screen flex flex-col items-center justify-center bg-background",children:[(0,a.jsxs)(l.E.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.5},className:"text-center",children:[(0,a.jsx)("h1",{className:"text-3xl md:text-5xl font-mono font-bold text-primary mb-2",children:"Dark Tide"}),(0,a.jsx)("p",{className:"text-text-secondary mb-6",children:"Electronic Diary"}),(0,a.jsx)(l.E.div,{animate:{scale:[1,1.1,1]},transition:{duration:1.5,repeat:1/0,repeatType:"loop"},children:(0,a.jsx)("div",{className:"w-12 h-12 border-2 border-primary border-t-transparent rounded-full animate-spin mx-auto"})})]}),t&&(0,a.jsx)(i,{onSubmit:h,isLoading:d,error:m})]})}}},function(e){e.O(0,[403,888,774,179],function(){return e(e.s=8312)}),_N_E=e.O()}]);