"use strict";(()=>{var e={};e.id=154,e.ids=[154],e.modules={1594:e=>{e.exports=require("hebece")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6249:(e,t)=>{Object.defineProperty(t,"l",{enumerable:!0,get:function(){return function e(t,r){return r in t?t[r]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,r)):"function"==typeof t&&"default"===r?t:void 0}}})},2615:(e,t,r)=>{r.r(t),r.d(t,{config:()=>d,default:()=>u,routeModule:()=>P});var o={};r.r(o),r.d(o,{default:()=>c});var n=r(1802),a=r(7153),i=r(6249);let s=async e=>{try{let t,o={};if(!e.startsWith("<html>"))return console.error("APIAP string is not in HTML format"),!1;{let t=e.match(/<input id="ap" type="hidden" value="(.*?)"><\/body>/);if(!t||!t[1])return console.error("Failed to extract value attribute from APIAP HTML"),!1;try{let e=t[1].replace(/&quot;/g,'"');o=JSON.parse(e),console.log("Successfully extracted and parsed JSON data from APIAP HTML")}catch(e){return console.error("Failed to parse JSON from APIAP HTML:",e),!1}}let n=`<html><head></head><body><input id="ap" type="hidden" value='${JSON.stringify(o)}' /></body></html>`;try{t=await Promise.resolve().then(r.t.bind(r,1594,23))}catch(e){return console.error("Failed to import hebece module:",e),!1}let a=t.Keypair,i=t.VulcanJwtRegister,s=t.VulcanHebeCe,l=await new a().init();console.log("Keypair initialized, attempting JWT register...");let c=await new i(l,n,0).init();console.log("JWT Register successful, connecting HebeCe...");let u=new s(l,c.Envelope.RestURL);return await u.connect(),void 0===global.__APIAP__&&(global.__APIAP__=n,console.log("APIAP stored in server-side global state after successful validation")),!0}catch(e){return console.error("APIAP validation failed:",e),!1}};var l=r(890);async function c(e,t){if("POST"!==e.method)return t.status(405).json({success:!1,error:"Method not allowed"});try{let{apiap:r}=e.body;if(!r)return t.status(400).json({success:!1,error:"API key is required"});if("string"!=typeof r||""===r.trim())return t.status(400).json({success:!1,error:"API key is required and must be a non-empty string."});if(!r.startsWith("<html>"))return t.status(400).json({success:!1,error:"Invalid APIAP format. The string must start with <html>"});if(!r.includes('<input id="ap" type="hidden" value="'))return t.status(400).json({success:!1,error:'Invalid APIAP format. The string must contain an input element with id="ap" and type="hidden"'});if(!r.includes("</body></html>"))return t.status(400).json({success:!1,error:"Invalid APIAP format. The string must end with </body></html>"});console.log("Validating APIAP string of length:",r.length);let o=await s(r);if(console.log("Validation result:",o),o)return(0,l.G5)(r),console.log("APIAP stored in server-side cache for API requests"),t.status(200).json({success:!0});return t.status(400).json({success:!1,error:"Invalid API key. Please check the APIAP string and try again."})}catch(r){console.error("API validation error:",r);let e=r instanceof Error?r.message:"Unknown error";return t.status(500).json({success:!1,error:`Failed to validate API key: ${e}. Please try again.`})}}let u=(0,i.l)(o,"default"),d=(0,i.l)(o,"config"),P=new n.PagesAPIRouteModule({definition:{kind:a.x.PAGES_API,page:"/api/validate-apiap",pathname:"/api/validate-apiap",bundlePath:"",filename:""},userland:o})},890:(e,t,r)=>{let o,n,a;r.d(t,{G5:()=>s,ZN:()=>h,_P:()=>d,bh:()=>A,tj:()=>u,w7:()=>P});let i=async()=>{try{let e=await Promise.resolve().then(r.t.bind(r,1594,23));return o=e.Keypair,n=e.VulcanJwtRegister,a=e.VulcanHebeCe,!0}catch(e){console.error("Failed to import hebece module:",e)}return!1};i().catch(e=>{console.error("Failed to initialize server modules:",e)});let s=e=>{e&&(console.log("Setting server-side APIAP cache"),global.__APIAP__=e)},l=(e=>{if(!e)return null;try{if(e.startsWith("<html>"))return e;let t={};if(e.trim().startsWith("{"))try{t=JSON.parse(e)}catch(e){console.error("Failed to parse APIAP as JSON:",e)}else{let r=e.match(/<input id="ap" type="hidden" value="(.*?)"><\/body>/);if(r&&r[1]){let e=r[1].replace(/&quot;/g,'"');try{t=JSON.parse(e)}catch(e){console.error("Failed to parse extracted HTML value as JSON:",e)}}}return`<html><head></head><body><input id="ap" type="hidden" value='${JSON.stringify(t)}' /></body></html>`}catch(e){return console.error("Error formatting APIAP string:",e),null}})(global.__APIAP__?(console.log("Using server-side cached APIAP"),global.__APIAP__):(console.warn("No APIAP available on server without explicit configuration"),null)),c=async()=>{if(!l)throw console.error("No valid APIAP string available. Cannot initialize Vulcan API."),Error("No valid API key found. Please authenticate first.");try{if((!o||!n||!a)&&!await i())throw Error("Failed to initialize required modules");let e=await new o().init(),t=await new n(e,l,0).init(),r=new a(e,t.Envelope.RestURL);return await r.connect(),r}catch(e){throw console.error("Failed to initialize Vulcan API:",e),Error("Failed to connect to Vulcan API")}},u=async(e,t)=>{try{let r=await c(),o=new Date(e),n=new Date(t);return(await r.getLessons(o,n)).Envelope||[]}catch(e){throw console.error("Error fetching lessons:",e),e}},d=async(e,t)=>{try{let r=await c(),o=new Date(e),n=new Date(t);return(await r.getExams(o,n)).Envelope||[]}catch(e){throw console.error("Error fetching exams:",e),e}},P=async(e,t)=>{try{let r=await c(),o=new Date(e),n=new Date(t);return(await r.getAttendance(o,n)).Envelope||[]}catch(e){throw console.error("Error fetching attendance:",e),e}},h=async()=>{try{let e=await c();return(await e.getGrades()).Envelope||[]}catch(e){throw console.error("Error fetching grades:",e),e}},A=async(e,t)=>{try{console.log(`[API CLIENT DEBUG] getHomework called with dates: ${e} to ${t}`);let r=await c(),o=new Date(e),n=new Date(t);console.log(`[API CLIENT DEBUG] Parsed dates: ${o.toISOString()} to ${n.toISOString()}`),console.log("[API CLIENT DEBUG] Calling hebe.getHomework...");let a=await r.getHomework(o,n);if(console.log("[API CLIENT DEBUG] Raw API response:",a),a&&a.Envelope)return console.log(`[API CLIENT DEBUG] Found Envelope with ${Array.isArray(a.Envelope)?a.Envelope.length:"non-array"} items`),a.Envelope||[];if(a&&Array.isArray(a))return console.log(`[API CLIENT DEBUG] Found array with ${a.length} items`),a;return console.log("[API CLIENT DEBUG] Unexpected data structure:",a),[]}catch(e){throw console.error("[API CLIENT DEBUG] Error fetching homework:",e),e}}},7153:(e,t)=>{var r;Object.defineProperty(t,"x",{enumerable:!0,get:function(){return r}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(r||(r={}))},1802:(e,t,r)=>{e.exports=r(145)}};var t=require("../../webpack-api-runtime.js");t.C(e);var r=t(t.s=2615);module.exports=r})();