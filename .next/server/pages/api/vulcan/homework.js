"use strict";(()=>{var e={};e.id=995,e.ids=[995],e.modules={1594:e=>{e.exports=require("hebece")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6249:(e,r)=>{Object.defineProperty(r,"l",{enumerable:!0,get:function(){return function e(r,t){return t in r?r[t]:"then"in r&&"function"==typeof r.then?r.then(r=>e(r,t)):"function"==typeof r&&"default"===t?r:void 0}}})},4304:(e,r,t)=>{t.r(r),t.d(r,{config:()=>A,default:()=>u,routeModule:()=>P});var o={};t.r(o),t.d(o,{default:()=>c});var n=t(1802),a=t(7153),l=t(6249),i=t(890);async function s(e,r){try{console.log("[API DEBUG] Homework API called with query:",e.query);let{startDate:t,endDate:o}=e.query;if(!t||!o)return console.log("[API DEBUG] Missing required parameters"),r.status(400).json({error:"Требуются параметры startDate и endDate"});console.log(`[API DEBUG] Fetching homework for date range: ${t} to ${o}`);let n=await (0,i.bh)(t,o);console.log("[API DEBUG] Received homework data:",typeof n),n&&(console.log(`[API DEBUG] Homework data length: ${Array.isArray(n)?n.length:"Not an array"}`),n.Envelope&&(console.log(`[API DEBUG] Homework has Envelope field with length: ${Array.isArray(n.Envelope)?n.Envelope.length:"Not an array"}`),Array.isArray(n.Envelope)&&n.Envelope.length>0&&console.log("[API DEBUG] First homework item:",n.Envelope[0])),Array.isArray(n)&&n.length>0&&console.log("[API DEBUG] First homework item from array:",n[0]));let a=Array.isArray(n)?n:n&&n.Envelope&&Array.isArray(n.Envelope)?n.Envelope:[];return console.log(`[API DEBUG] Returning ${a.length} homework items`),r.status(200).json(a)}catch(e){return console.error("[API DEBUG] Error in homework API:",e),r.status(500).json({error:"Error retrieving homework data"})}}let c=(0,t(5342).Y)(s),u=(0,l.l)(o,"default"),A=(0,l.l)(o,"config"),P=new n.PagesAPIRouteModule({definition:{kind:a.x.PAGES_API,page:"/api/vulcan/homework",pathname:"/api/vulcan/homework",bundlePath:"",filename:""},userland:o})},890:(e,r,t)=>{let o,n,a;t.d(r,{G5:()=>i,ZN:()=>h,_P:()=>A,bh:()=>d,tj:()=>u,w7:()=>P});let l=async()=>{try{let e=await Promise.resolve().then(t.t.bind(t,1594,23));return o=e.Keypair,n=e.VulcanJwtRegister,a=e.VulcanHebeCe,!0}catch(e){console.error("Failed to import hebece module:",e)}return!1};l().catch(e=>{console.error("Failed to initialize server modules:",e)});let i=e=>{e&&(console.log("Setting server-side APIAP cache"),global.__APIAP__=e)},s=(e=>{if(!e)return null;try{if(e.startsWith("<html>"))return e;let r={};if(e.trim().startsWith("{"))try{r=JSON.parse(e)}catch(e){console.error("Failed to parse APIAP as JSON:",e)}else{let t=e.match(/<input id="ap" type="hidden" value="(.*?)"><\/body>/);if(t&&t[1]){let e=t[1].replace(/&quot;/g,'"');try{r=JSON.parse(e)}catch(e){console.error("Failed to parse extracted HTML value as JSON:",e)}}}return`<html><head></head><body><input id="ap" type="hidden" value='${JSON.stringify(r)}' /></body></html>`}catch(e){return console.error("Error formatting APIAP string:",e),null}})(global.__APIAP__?(console.log("Using server-side cached APIAP"),global.__APIAP__):(console.warn("No APIAP available on server without explicit configuration"),null)),c=async()=>{if(!s)throw console.error("No valid APIAP string available. Cannot initialize Vulcan API."),Error("No valid API key found. Please authenticate first.");try{if((!o||!n||!a)&&!await l())throw Error("Failed to initialize required modules");let e=await new o().init(),r=await new n(e,s,0).init(),t=new a(e,r.Envelope.RestURL);return await t.connect(),t}catch(e){throw console.error("Failed to initialize Vulcan API:",e),Error("Failed to connect to Vulcan API")}},u=async(e,r)=>{try{let t=await c(),o=new Date(e),n=new Date(r);return(await t.getLessons(o,n)).Envelope||[]}catch(e){throw console.error("Error fetching lessons:",e),e}},A=async(e,r)=>{try{let t=await c(),o=new Date(e),n=new Date(r);return(await t.getExams(o,n)).Envelope||[]}catch(e){throw console.error("Error fetching exams:",e),e}},P=async(e,r)=>{try{let t=await c(),o=new Date(e),n=new Date(r);return(await t.getAttendance(o,n)).Envelope||[]}catch(e){throw console.error("Error fetching attendance:",e),e}},h=async()=>{try{let e=await c();return(await e.getGrades()).Envelope||[]}catch(e){throw console.error("Error fetching grades:",e),e}},d=async(e,r)=>{try{console.log(`[API CLIENT DEBUG] getHomework called with dates: ${e} to ${r}`);let t=await c(),o=new Date(e),n=new Date(r);console.log(`[API CLIENT DEBUG] Parsed dates: ${o.toISOString()} to ${n.toISOString()}`),console.log("[API CLIENT DEBUG] Calling hebe.getHomework...");let a=await t.getHomework(o,n);if(console.log("[API CLIENT DEBUG] Raw API response:",a),a&&a.Envelope)return console.log(`[API CLIENT DEBUG] Found Envelope with ${Array.isArray(a.Envelope)?a.Envelope.length:"non-array"} items`),a.Envelope||[];if(a&&Array.isArray(a))return console.log(`[API CLIENT DEBUG] Found array with ${a.length} items`),a;return console.log("[API CLIENT DEBUG] Unexpected data structure:",a),[]}catch(e){throw console.error("[API CLIENT DEBUG] Error fetching homework:",e),e}}},5342:(e,r,t)=>{t.d(r,{Y:()=>n});var o=t(890);let n=e=>async(r,t)=>{try{let n=r.headers["x-apiap"];return n?(console.log("[API CONFIG] APIAP provided in request header"),(0,o.G5)(n)):global.__APIAP__?console.log("[API CONFIG] Using existing server-side APIAP cache"):console.log("[API CONFIG] No APIAP available in headers or cache"),e(r,t)}catch(e){return console.error("[API CONFIG] Error in API configuration:",e),t.status(500).json({error:"Internal server error in API configuration"})}}},7153:(e,r)=>{var t;Object.defineProperty(r,"x",{enumerable:!0,get:function(){return t}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(t||(t={}))},1802:(e,r,t)=>{e.exports=t(145)}};var r=require("../../../webpack-api-runtime.js");r.C(e);var t=r(r.s=4304);module.exports=t})();