"use strict";(()=>{var e={};e.id=600,e.ids=[600],e.modules={1594:e=>{e.exports=require("hebece")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6249:(e,t)=>{Object.defineProperty(t,"l",{enumerable:!0,get:function(){return function e(t,o){return o in t?t[o]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,o)):"function"==typeof t&&"default"===o?t:void 0}}})},9517:(e,t,o)=>{o.r(t),o.d(t,{config:()=>A,default:()=>P,routeModule:()=>g});var r={};o.r(r),o.d(r,{default:()=>c});var n=o(1802),l=o(7153),a=o(6249),i=o(890);async function s(e,t){try{console.log("[API DEBUG] Lessons API called with query:",e.query),console.log("[API DEBUG] Checking global APIAP state:",global.__APIAP__?`Found with length ${global.__APIAP__.length}`:"Not found");let{startDate:o,endDate:r}=e.query;if(!o||!r)return console.error("[API DEBUG] Missing required parameters startDate or endDate"),t.status(400).json({error:"Требуются параметры startDate и endDate"});console.log(`[API DEBUG] Fetching lessons for date range: ${o} to ${r}`);let n=await (0,i.tj)(o,r);return n&&Array.isArray(n)?(console.log(`[API DEBUG] Received ${n.length} lessons`),n.length>0&&console.log("[API DEBUG] Sample lesson:",n[0])):console.log("[API DEBUG] Unexpected response format:",n),t.status(200).json(n)}catch(e){return console.error("[API DEBUG] Error in lessons API:",e),t.status(500).json({error:"Ошибка при получении данных о расписании"})}}let c=(0,o(5342).Y)(s),P=(0,a.l)(r,"default"),A=(0,a.l)(r,"config"),g=new n.PagesAPIRouteModule({definition:{kind:l.x.PAGES_API,page:"/api/vulcan/lessons",pathname:"/api/vulcan/lessons",bundlePath:"",filename:""},userland:r})},890:(e,t,o)=>{let r,n,l;o.d(t,{ZN:()=>A,_P:()=>c,bh:()=>g,tj:()=>s,w7:()=>P});let a=async()=>{try{let e=await Promise.resolve().then(o.t.bind(o,1594,23));return r=e.Keypair,n=e.VulcanJwtRegister,l=e.VulcanHebeCe,!0}catch(e){console.error("Failed to import hebece module:",e)}return!1};a().catch(e=>{console.error("Failed to initialize server modules:",e)}),(e=>{if(e)try{if(e.startsWith("<html>"))return e;let t={};if(e.trim().startsWith("{"))try{t=JSON.parse(e)}catch(e){console.error("Failed to parse APIAP as JSON:",e)}else{let o=e.match(/<input id="ap" type="hidden" value="(.*?)"><\/body>/);if(o&&o[1]){let e=o[1].replace(/&quot;/g,'"');try{t=JSON.parse(e)}catch(e){console.error("Failed to parse extracted HTML value as JSON:",e)}}}return`<html><head></head><body><input id="ap" type="hidden" value='${JSON.stringify(t)}' /></body></html>`}catch(e){return console.error("Error formatting APIAP string:",e),null}})(global.__APIAP__?(console.log("Using server-side cached APIAP"),global.__APIAP__):(console.warn("No APIAP available on server without explicit configuration"),null));let i=async()=>{let e=global.__APIAP__;if(console.log("[API CLIENT] Global state check:",e?`APIAP found with length: ${e.length}`:"No APIAP found in global state"),!e)throw console.error("No valid APIAP string available in global state. Cannot initialize Vulcan API."),console.log("[API CLIENT] Available global properties:",Object.keys(global).join(", ")),Error("No valid API key found. Please authenticate first.");try{if((!r||!n||!l)&&(console.log("[API CLIENT] Initializing server modules..."),!await a()))throw Error("Failed to initialize required modules");console.log("[API CLIENT] Using server-side cached APIAP for API initialization...");let t=await new r().init();console.log("[API CLIENT] Keypair initialized, creating JWT register with APIAP...");let o=await new n(t,e,0).init();console.log("[API CLIENT] JWT register successful, RestURL:",o.Envelope.RestURL);let i=new l(t,o.Envelope.RestURL);return console.log("[API CLIENT] Connecting HebeCe..."),await i.connect(),console.log("[API CLIENT] HebeCe connected successfully"),i}catch(e){throw console.error("[API CLIENT] Failed to initialize Vulcan API:",e),Error("Failed to connect to Vulcan API")}},s=async(e,t)=>{try{let o=await i(),r=new Date(e),n=new Date(t);return(await o.getLessons(r,n)).Envelope||[]}catch(e){throw console.error("Error fetching lessons:",e),e}},c=async(e,t)=>{try{let o=await i(),r=new Date(e),n=new Date(t);return(await o.getExams(r,n)).Envelope||[]}catch(e){throw console.error("Error fetching exams:",e),e}},P=async(e,t)=>{try{let o=await i(),r=new Date(e),n=new Date(t);return(await o.getAttendance(r,n)).Envelope||[]}catch(e){throw console.error("Error fetching attendance:",e),e}},A=async()=>{try{let e=await i();return(await e.getGrades()).Envelope||[]}catch(e){throw console.error("Error fetching grades:",e),e}},g=async(e,t)=>{try{console.log(`[API CLIENT DEBUG] getHomework called with dates: ${e} to ${t}`);let o=await i(),r=new Date(e),n=new Date(t);console.log(`[API CLIENT DEBUG] Parsed dates: ${r.toISOString()} to ${n.toISOString()}`),console.log("[API CLIENT DEBUG] Calling hebe.getHomework...");let l=await o.getHomework(r,n);if(console.log("[API CLIENT DEBUG] Raw API response:",l),l&&l.Envelope)return console.log(`[API CLIENT DEBUG] Found Envelope with ${Array.isArray(l.Envelope)?l.Envelope.length:"non-array"} items`),l.Envelope||[];if(l&&Array.isArray(l))return console.log(`[API CLIENT DEBUG] Found array with ${l.length} items`),l;return console.log("[API CLIENT DEBUG] Unexpected data structure:",l),[]}catch(e){throw console.error("[API CLIENT DEBUG] Error fetching homework:",e),e}}},5342:(e,t,o)=>{o.d(t,{Y:()=>r});let r=e=>async(t,o)=>{try{let r=t.headers["x-apiap"];return r?(console.log("[API CONFIG] APIAP provided in request header with length:",r.length),global.__APIAP__=r):global.__APIAP__?console.log("[API CONFIG] Using existing server-side APIAP cache with length:",global.__APIAP__.length):console.log("[API CONFIG] No APIAP available in headers or global state"),e(t,o)}catch(e){return console.error("[API CONFIG] Error in API configuration:",e),o.status(500).json({error:"Internal server error in API configuration"})}}},7153:(e,t)=>{var o;Object.defineProperty(t,"x",{enumerable:!0,get:function(){return o}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(o||(o={}))},1802:(e,t,o)=>{e.exports=o(145)}};var t=require("../../../webpack-api-runtime.js");t.C(e);var o=t(t.s=9517);module.exports=o})();